#!/bin/bash
set -euo pipefail

# Documentation hints:
#
# https://medium.com/google-developers/how-to-generate-fabulous-api-reference-docs-for-ios-5bd297b9697d
# https://medium.com/google-developers/how-to-migrate-ios-api-reference-from-doxygen-to-jazzy-35bd89c6a92b
# https://pandoc.org
# https://kapeli.com/docsets

function current_script_fullpath() {
    local scriptfile
    if (( $BASH_SUBSHELL > 1 ))
    then
        echo ">>> Error: function '$FUNCNAME' can't be invoked in a sub-shell." 1>&2
        kill -9 -- $$
        exit 1
    fi
    scriptfile="$( cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    scriptfile="${scriptfile}"/$(basename "$0")
    echo "$scriptfile"
}

source_path="$(current_script_fullpath)"
cd "$(dirname "$source_path")"

mkdir Temp
ditto Branch Temp/Branch
ditto Branch.xcodeproj Temp
ditto LICENSE Temp
ditto README.md Temp
cd Temp

jazzy \
    --clean \
    --objc \
    --umbrella-header Branch/Branch.h \
    --framework-root . \
    --module Branch \
    --sdk macosx \
    --author Branch \
    --author_url https://branch.io \
    --module-version 1.0.0 \
    --copyright "Copyright Â© 2018 Branch. All rights reserved." \
    --use-safe-filenames \
    --exclude=Branch/BNCLog.h,Branch/BranchMainClass+Private.h \
    --output ../Documentation/HTMLDocumentation \
    --github_url "https://github.com/BranchMetrics/Branch-SDK-Mac" \
    --github-file-prefix  "https://github.com/BranchMetrics/Branch-SDK-Mac/tree/v1.0.0" \
    --docset-icon Documentation/Images/Branch-16.png \
    --docset-path ../Documentation

#     --podspec FILEPATH \
#     --skip-documentation

cd ..
ln -vsf Documentation/HTMLDocumentation/index.html Documentation.html

cp Documentation/Images/Branch-16.png \
   Documentation/HTMLDocumentation/icon.png

# cp Documentation/Images/Branch-16.png \
#    Documentation/HTMLDocumentation/docsets/Branch.docset/icon.png

cp Documentation/Images/Branch-32.png \
   Documentation/HTMLDocumentation/icon@2x.png

# cp Documentation/Images/Branch-32.png \
#    Documentation/HTMLDocumentation/docsets/Branch.docset/icon@2x.png

rm -Rf Temp
